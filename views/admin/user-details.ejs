<%- include('../partials/header', { title: 'تفاصيل المستخدم', activePage: 'users', admin: true }) %>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>تفاصيل المستخدم: <%= user.name %></h2>
    <a href="/admin/users" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-right"></i> العودة للمستخدمين
    </a>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">معلومات أساسية</h5>
            </div>
            <div class="card-body">
                <p><strong>المعرف:</strong> <%= user.id %></p>
                <p><strong>الاسم:</strong> <%= user.name %></p>
                <p><strong>رقم الهاتف:</strong> <%= user.phone %></p>
                <p><strong>الدور:</strong> <%= user.role %></p>
                <p><strong>نقاط الولاء:</strong> <%= user.loyalty_points || 0 %></p>
                <p><strong>تاريخ التسجيل:</strong> <%= new Date(user.created_at).toLocaleDateString('ar-SA') %></p>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">العناوين</h5>
            </div>
            <div class="card-body">
                <% if (addresses && addresses.length > 0) { %>
                    <ul class="list-group list-group-flush">
                        <% addresses.forEach(address => { %>
                            <li class="list-group-item">
                                <%= address.street %>, <%= address.city %><br>
                                <small class="text-muted"><%= address.details || '' %></small>
                            </li>
                        <% }); %>
                    </ul>
                <% } else { %>
                    <p class="text-muted">لا توجد عناوين محفوظة.</p>
                <% } %>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">طلبات المستخدم</h5>
            </div>
            <div class="card-body">
                <% if (orders && orders.length > 0) { %>
                    <div class="table-responsive">
                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th>رقم الطلب</th>
                                    <th>التاريخ</th>
                                    <th>المبلغ</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% orders.forEach(order => { %>
                                    <tr>
                                        <td>#<%= order.id %></td>
                                        <td><%= new Date(order.order_date).toLocaleDateString('ar-SA') %></td>
                                        <td><%= order.total_amount %> ريال</td>
                                        <td><span class="badge bg-info"><%= order.status %></span></td>
                                        <td>
                                            <a href="/admin/orders/<%= order.id %>" class="btn btn-sm btn-outline-primary">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% } else { %>
                    <p class="text-muted">لا توجد طلبات لهذا المستخدم.</p>
                <% } %>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">اشتراكات المستخدم</h5>
            </div>
            <div class="card-body">
                <% if (subscriptions && subscriptions.length > 0) { %>
                    <div class="table-responsive">
                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th>الخطة</th>
                                    <th>تاريخ البدء</th>
                                    <th>تاريخ الانتهاء</th>
                                    <th>الحالة</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% subscriptions.forEach(sub => { %>
                                    <tr>
                                        <td><%= sub.plan_name %></td>
                                        <td><%= new Date(sub.start_date).toLocaleDateString('ar-SA') %></td>
                                        <td><%= new Date(sub.end_date).toLocaleDateString('ar-SA') %></td>
                                        <td><span class="badge bg-success"><%= sub.status %></span></td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% } else { %>
                    <p class="text-muted">لا توجد اشتراكات لهذا المستخدم.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>
